library(dataRetrieval)
library(wqTools)
library(wasteloadR)
library(dplyr)
library(plotly)
library(knitr)
library(writexl)
pid=selectPermit()
pid
permit_location=subset(wasteloadR::permits_coords, permit_id==pid)
permit_location
sites=findSites()
knitr::kable(sites)
map_sites=within(sites, {
lab=paste0(
'<p>',
'<br />', "Site ID: ", site_id,
'<br />', "Site name: ", site_name,
'<br />', "Site type: ", type,
'<br />', "Visit count: ", visit_count)
color=NA
color[type=="Monitoring location"]="purple"
color[type=="Permit"]="orange"
color[type=="Gauge"]="blue"
})
baseMap() %>%
addCircleMarkers(data=map_sites, lat=~lat, lng=~long, options = pathOptions(pane = "markers"), group="Sites",
color = ~color, opacity=0.8, layerId=~site_id,
label = lapply(map_sites$lab, HTML) # crashes if only one site is selected for lapply
) %>%
addLegend("topright", colors=c("purple","orange","blue"), labels=c("Monitoring location", "Permit", "USGS gauge")) %>%
fitBounds(min(map_sites$long), min(map_sites$lat), max(map_sites$long), max(map_sites$lat))
??fitBounds
library(leaflet)
map_sites=within(sites, {
lab=paste0(
'<p>',
'<br />', "Site ID: ", site_id,
'<br />', "Site name: ", site_name,
'<br />', "Site type: ", type,
'<br />', "Visit count: ", visit_count)
color=NA
color[type=="Monitoring location"]="purple"
color[type=="Permit"]="orange"
color[type=="Gauge"]="blue"
})
baseMap() %>%
addCircleMarkers(data=map_sites, lat=~lat, lng=~long, options = pathOptions(pane = "markers"), group="Sites",
color = ~color, opacity=0.8, layerId=~site_id,
label = lapply(map_sites$lab, HTML) # crashes if only one site is selected for lapply
) %>%
addLegend("topright", colors=c("purple","orange","blue"), labels=c("Monitoring location", "Permit", "USGS gauge")) %>%
fitBounds(min(map_sites$long), min(map_sites$lat), max(map_sites$long), max(map_sites$lat))
echo_data=readECHO_ec(p_id="UT0021741", start_date="01/01/2000", end_date="08/05/2020", print=F)
wqp_sites=readWQP(type="sites", siteid=subset(qsites, type=="Monitoring location")$site_id)
echo_data=readECHO_ec(p_id="UT0021741", start_date="01/01/2000", end_date="10/12/2022", print=F)
wqp_sites=readWQP(type="sites", siteid=subset(sites, type=="Monitoring location")$site_id)
wqp_res=readWQP(type="result", siteid=subset(sites, type=="Monitoring location")$site_id)
wqp_data=merge(wqp_sites, wqp_res)
summ_data=subset(wqp_data,
MonitoringLocationIdentifier %in% c("UTAHDWQ_WQX-4990060", "UTAHDWQ_WQX-4990070", "UTAHDWQ_WQX-4990080") &
CharacteristicName %in% c("Total suspended solids","Phosphate-phosphorus","Total dissolved solids","pH","Temperature, water")
)
table_data=unique(data.frame(summ_data[,c("CharacteristicName","ActivityTypeCode","ResultSampleFractionText","ResultMeasure.MeasureUnitCode")]))
knitr::kable(table_data[order(table_data$CharacteristicName),])
